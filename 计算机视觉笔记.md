# 计算机视觉

## 1.计算机视觉定义

#### 1.1 定义

​		是一门研究如何使机器“看”的科学，更进一步的说，就是是指用摄影机和电脑代替人眼对目标进行识别 、跟踪和测量等，并进一步做图形处理，用电脑处理成为更适合人眼观察或传送给仪器检测的图像。 

#### 1.2 计算机视觉相对人类视觉的优缺点

##### 1.2.1 缺点

1. 人可通过视觉和听觉，语言与外界交换信息，而目前的计算机视觉基本是仅通过视频来按照某种规则来进行工作的一种程序。
2. 环境适应能力较弱，人类可以根据少量视频或图像资源进行识别、推理，而计算机视觉不具备这种能力
3. 人类双目视觉看到的物体是三维的，而大多计算机视觉是基于二维视频进行分析的，缺少深度信息。

##### 1.2.2 优点

1. 计算机可以有各种成像方式，可以看到人眼看不到的东西。
2. 根据设定程序或者规则运行，很少会产生人类视觉一样的错觉现象。
3. 无疲劳，在规则较简单、环境较简单的应用场景中性能优于人类视觉。

## 2. 像素间的关系



#### 2.1 像素间邻域

1. **邻接**：对两个像素p和q来说，如果q在p的邻域中，则称p和q满足邻接关系
2. **连接**：p和q邻接且灰度值均满足某个特定的相似准则
3. **连通**：不（直接）邻接，但均在另一个像素的相同邻域中， 且这3个像素的灰度值均满足某个特定的相似准则
4. **通路**：两个像素p和q间有一系列依次连接的像素使得p和q是 连通的，则这些像素构成p和q间的通路

几种像素关系之间的关系：

![](.\images\image1)

#### 2.2 像素间的距离

![](.\images\image20230622151706916)



## 3.图像采集

### 3.1 定义

​		计算机视觉过程是从获取客观世界的图像开始的，图像采集是获取图像的技术或手段。 

图像采集需要解决的问题： 

  (1) 利用几何光学原理解决场景中目标投影在图像中位置问题。

  (2)利用辐射学或光度学建立场景中目标亮度和图像中对应幅度值的关系。

### 3.2 采集装置

- CCD摄像机
- CMOS摄像机
- CID摄像机

采集装置的性能指标：

1. 线性响应
2. 灵敏度
3. 空间分辨率
4. 幅度分辨率
5. 信噪比
6. 快门速度
7. 读出速度

### 3.3 采集模型

#### 3.3.1 几何成像模型

​		图像采集的过程从几何角度可看作是一个将客观世界的场景通过投影进行空间转化的过程。称为投影成像系统。

  投影成像涉及到在不同坐标系统之间的转换

 (1)　世界坐标系统：XYZ 

 (2)　摄像机坐标系统：*xyz* 

 (3)　图像平面坐标系统：x'y‘ 

​	一般取图像平面与摄像机坐标系统的*xy*平面平行，且*x*轴与*x'*轴、*y*轴与*y'*轴分别重合 。这样图像平面中心点就在光轴上  。

![](.\images\image20230622151839249)

​	λ表示 镜头焦距，镜头中心点坐标为(0,0,λ）， 假设(X,Y,Z)表示世界坐标系W中的任意点。借助相似三角形得到图像坐标和世界坐标的关系。

$$
x=\frac{\lambda X}{\lambda-Z},y=\frac{\lambda Y}{\lambda -Z}
$$

#### 3.3.2 图像平面与摄像机平面之间的关系

假设每一个像素在x’轴和y’轴方向上的物理尺寸为dx和dy，有：

$$
x'=\frac{x}{dx}+x_0
$$

$$
y'=\frac{y}{dy}+y_0
$$

## 4.基元检测

**基元**泛指图像中有特点的基本单元，如，**边缘、角点、直线段、圆、孔等。**

- **边缘**是图像中比较低层的基元，是组成许多其他基元的基础。
- **角点**可以看做由两个边缘以接近直角相结合而构成的基元。
- **直线段**可看做是两个邻近又互相平行的边缘相结合而构成的基元
- **圆**是一种常见的几何形状，圆周可看做是将直线段弯曲。头尾相接得到的。
- **孔**的形状与圆相同，但一般用孔来表示比较小的圆。

## 4.1 <u>边缘检测</u>

​		在边缘处，灰度和结构等信息的产生突变. 边缘是一个区域的结束,也是另一个区域的开始。**沿边缘方向像素变化平缓**,**垂直于边缘方向像素变化剧烈**

**基本思想**：**导数反映图像灰度变化的显著程度．** **一阶导数的局部极大值，二阶导数的过零点**

**一般过程**：**去噪      增强        检测**        

#### 4.1.1 一阶导数算子

1. 梯度：

$$
G(x,y)=\left[
 \begin{matrix}
   G_x  \\
   G_y
     
  \end{matrix}
     \right]
$$

2. 梯度的幅值：
   
$$
|G(x,y)|=\sqrt{G_x^2+G_y^2}
$$

3. 梯度的方向：

$$
a(x,y)=\arctan(G_y/G_x)
$$

4. ![image-20230622151938590](.\images\image20230622151938590)

   ![image-20230622152009300](.\images\image-20230622152009300.png)

6. 一阶导数算子存在的问题： **图像收到噪声干扰，不能准确的检测边缘**

​		解决方法：**在边缘检测前对图像进行平滑处理**

#### 4.1.2 二阶导数算子

​		图像强度的二阶导数的零点即为边缘点。

**1. 拉普拉斯算子**

$$
{\nabla ^2}f = \frac{{{\partial ^2}f}}{{\partial {x^2}}} + \frac{{{\partial ^2}f}}{{\partial {y^2}}}
$$


$$
\begin{aligned}
\frac{{{\partial ^2}f}}{{\partial {x^2}}} &= \frac{{\partial {G_x}}}{{\partial x}}\\
 &= \frac{{\partial (f[x + 1,y] - f[x,y])}}{{\partial x}}\\
 &= \frac{{\partial f[x + 1,y]}}{{\partial x}} - \frac{{\partial f[x,y]}}{{\partial x}}\\
 &= f[x + 2,y] - 2f[x + 1,y] + f[x,y]
\end{aligned}
$$

​	可以以各种经验定义拉普拉斯算子：

1. 用算子表示：
   
$$
   {\nabla ^2} \approx \left[ {\begin{array}{*{20}{c}}
   0&1&0\\
   1&{ - 4}&1\\
   0&1&0
   \end{array}} \right]
$$

2. 希望邻域中心点具有更大的权值：
   
$$
   {\nabla ^2} \approx \left[ {\begin{array}{*{20}{c}}
   1&4&1\\
   4&{ -20}&4\\
   1&4&1
   \end{array}} \right]
$$


**要求矩阵内系数和=0**

**2. Canny算子**

**1）. 最优边缘检测的特征 **

i）**低错误率**：表示出尽可能多的边缘，同时尽可能减少噪声产生的误报

ii）**高定位性**：标识出的边缘要与图像中他=的实际边缘尽可能接近

iii）**最小响应**：图像中的边缘只能表示一次，对虚假边缘响应要尽可能抑制

**2)** Canny算子准则

1. 对输入图像进行平滑，降低错误率,如下为高斯平滑：
   
$$
   S(x,y) = g(x,y)*G(x,y)
$$

   其中， 高斯核如下：

$$
   G(x, y)=\frac{1}{2 \pi \sigma^{2}} e^{-\frac{x^{2}+y^{2}}{2 \sigma^{2}}}
$$

2. 计算梯度幅度和方向来估计每一点处的边缘强度与方向，可以通过Sobel算子与Prewitt算子实现：

   i）计算梯度：
   
$$
   {H_1} = \left[ {\begin{array}{*{20}{c}}
   { - 1}&{ - 1}\\
   1&1
   \end{array}} \right],{H_2} = \left[ {\begin{array}{*{20}{c}}
   1&{ - 1}\\
   1&{ - 1}
   \end{array}} \right]
$$

$$
   \begin{array}{l}
   {\varphi _1}(x,y) = S(x,y)*{H_1}(x,y)\\
   {\varphi _2}(x,y) = S(x,y)*{H_2}(x,y)
   \end{array}
$$

   ii) 梯度方向:

$$
   \theta  = \arctan ({\varphi _2}/{\varphi _1})
$$

3. 根据梯度方向，对梯度幅值进行非极大值抑制

   ![image-20230622154140385](.\images\image-20230622154140385.png)

   在每一点X与沿着其对应的梯度方向的两个像素相比，若x像素为最大值，则保留，否则中心置0，这样可以抑制非极大值，保留局部梯度最大的点，以得到细化的边缘。

4. 用双阈值处理和连接边缘

   选取系数TH和TL，比率为2:1或3:1。（一般取TH=0.3或0.2,TL=0.1）
    将小于低阈值TL的点置0；将大于高阈值TH的点立即标记（这些点为确定边缘点），置255。
    中间的值：考察8邻域是否有边缘点，若没有，表示这是一个孤立的局部极大值点，排除，置为0；若有，表示这是一个跟其他边缘有连接，置为255，之后重复执行该步骤，直到考察完之后一个像素点

**3.SUSAN算子**

​		SUSAN算子是一种高效的边缘和角点检测算子， 只使用一个圆形模版来得到各向同性的响应。不仅可以检测出图像中目标的**边缘点，而且能鲁棒地检测出图像中目标的角点。**

**特点**：简单、有效、抗噪声能力强、计算速度快的特点。

![image-20230622153032513](.\images\image-20230622153032513.png)

​		图中图像的上部分为亮区域，下部分为暗区域，分别代表目标和背景。将圆形的模板放在6个典型位置。

​		从左到右:第1个模板全部在亮区域，第2个模板大部在亮区域，第3个模板一半在亮区域，第4个模板大部分在暗区域，第5个模板全部在暗区域，第6个模板的1/4在暗区域。

​		SUSAN算子采用了一个圆形模板：

![image-20230622154540793](.\images\image-20230622154540793.png)

$$
M = \left[ {\begin{array}{*{20}{c}}
0&0&1&1&1&0&0\\
0&1&1&1&1&1&0\\
1&1&1&1&1&1&1\\
1&1&1&1&1&1&1\\
1&1&1&1&1&1&1\\
0&1&1&1&1&1&0\\
0&0&1&1&1&0&0
\end{array}} \right]
$$

设模板函数为M(x,y)，将其依次放在图像中每个点的位置，在每个位置，将模板内每个像素的灰度值与核的灰度值进行比较。

$$
C\left(x_{0}, y_{0} ; x, y\right)=\left\{\begin{array}{lll}1 &  & \left|f\left(x_{0}, y_{0}\right)-f(x, y)\right| \leq T \\ 0 &  & \left|f\left(x_{0}, y_{0}\right)-f(x, y)\right|>T\end{array}\right.
$$

计算核同值区【总游程】:

$$
S\left(x_{0}, y_{0}\right)=\sum_{(x, y) \in M(x, y)} C\left(x_{0}, y_{0} ; x, y)\right.
$$

得到初始边缘响应：

$$
R\left(x_{0}, y_{0}\right)=\left\{\begin{array}{ll}G-S\left(x_{0}, y_{0}\right) &  S\left(x_{0}, y_{0}\right)<G \\ 0 & \end{array}\right.
$$

USAN的面积越小，边缘的响应越大。G一般选取(3/4)* Smax。Smax 是S所能取的最大值,使用上面的37像素模板，Smax = 37 。

得到角点响应，阈值G = 0.5 * Smax 。

使用非极大抑制，简单判断角点响应图中8邻域，判断是否是周围8个点中最大的值，是则保留。 

角点附近的点，SUSAN 响应值都是最大的

**SUSAN算子的优点**：

1. 算子原理简单，易于计算
2. 不涉及梯度的计算，同时是相邻较大区域像素的差异，因此其具有较强的抗噪声能力
3. 计算量小
4. 能够同时检测角点和边缘
5. 旋转不变性、灰度不变性、尺度不变性

**SUSAN算子缺点**：

1. 需要控制阈值来达到最佳效果
2. 需设定条件来排除伪角点

#### 4.1.3 Hough变换

**1. 霍夫变换的基本思想**：点与线的对偶性，通过边缘上N给点的点集，找到共线的点集和对应的直线方程。

在笛卡尔坐标系中，一条直线可以由两个点确定，直线y=kx+b可以转化为k与b的方程，即b=-kx+y。这样的空间即为**霍夫空间**，笛卡尔坐标系中的一条直线对应霍夫空间的一个点，笛卡尔坐标系中的一个点对应霍夫空间里的一条直线。

**2. 霍夫变换实现对圆的检测**

在笛卡尔坐标系中，圆的方程定义为:
$$
(x-a)^2+(y-b)^2=r^2
$$
转换到极坐标中：
$$
x=a+r\cos\theta & a=x-r\cos\theta \\
y=b+r\cos\theta & b=y-r\cos\theta
$$
具体做法：

1. 提取图像边缘并得到2值图像。 可以使用canny算子  
2. 对于每一个边缘点，从最小半径r_min 到最大半径r_max ，计算霍夫空间值 (r,a,b)【公式】
3. 统计霍夫空间中3维点对出现的次数。出现次数大于设定阈值的即为圆的半径和圆心。

## 5.图像分割

### 5.1 基本阈值技术

**1.基本思想**：根据图像数据的特征将图像空间划分为互不重叠的区域，从而达到分割的目的

**2.阈值分割实质**：二值化方法，将图像分为两类：前景目标和背景

#### 5.2 OTSU 最大类间方差：选取最佳阈值

**1.基本思想**：根据图像的灰度特性,将图像分为前景和背景两个部分。当取最佳阈值时，两部分之间的差别应该是最大的。前景和背景之间的类间方差如果越大，就说明构成图像的两个部分之间的差别越大，当部分目标被错分为背景或部分背景被错分为目标，都会导致两部分差别变小，当所取阈值的分割使类间方差最大时就意味着错分概率最小

**2.基本流程**

1. 先统计灰度直方图[每个像素的个数]。设ni 表示图像中灰度为i的像素数，则图像中有 n0,n1.....n255.

   ​    写为概率形式： pi = ni/(n0+n1...+n255)，其中：
   $$
   \sum_{i=0}^{255}{p_i=1}
   $$

2. 设阈值为 k时，像素被分到A的概率为pA(k)，分到B的概率为pB(k)。分到A的像素的平均值mA(k)，分到B的像素的平均值mB(k)，整个图像的灰度均值是m_G

   则有：
   $$
   p_A(k)*m_A(k)+p_B(k)*m_B(k)=m_G\\
   p_A(k)+p_B(k)=1
   $$
   

![image-20230623162822385](.\images\image20230623162822385)

根据方差，类间方差表达式为：
$$
{\delta ^2} = {p_A}(k){({m_A} - {m_{\rm{G}}})^2} + {p_B}(k){({m_B} - {m_G})^2}
$$
整理合并后
$$
{\delta ^2} = {p_A}(k){p_B}(k){({m_A} - {m_B})^2}
$$

$$
{p_A}(k) = \sum\limits_{i = 0}^k {{p_i}}\\
{p_{\rm{B}}}(k) = \sum\limits_{i = k + 1}^{255} {{p_i}} 
$$

$$
{m_A}(k) = \sum\limits_{i = 0}^k {ip(i|A)}= \sum\limits_{i = 0}^k {ip(A|i)} {p_i}/{p_A} = \frac{1}{{{p_A}}}\sum\limits_{i = 0}^k i {p_i}
$$

$$
{m_B}(k) = \frac{1}{{{p_B}}}\sum\limits_{i = k + 1}^{255} i {p_i}
$$

**求能使上式最大化的k即为OTSU阈值。**

## 6.目标表达和描述

### 6.1 基于边界的描述

#### 6.1.1 定义

得到图像的边界，需要描述目标的特性。基于边界的描述定义为：通过边界点信息来对目标进行描述的方法。

特征： 边界长度、边界直径、边界的形状、轮廓形状等

​	1．边界的长度：边界所包围区域的轮廓的周长。

​	2．边界的直径：是边界上相隔最远的两点之间的距离，即这两点直线连线段长度。

#### 6.1.2 链码

**1.定义**：链码是对边界点的一种编码方法，**美国学者Freeman提出。**

**2.特点**：用一系列具有特定长度和方向的相连直线段来表示目标的边界，边界的起点用绝对坐标表示，其余点可以用接续方向来代表偏移量

**3. 4方向链码与8方向链码**：

![image-20230623163825483](.\images\image20230623163825483)

**4. 存在的问题**

1. 链码过长，噪声等干扰导致小的边界变化，使链码发生与目标整体形状无关的较大变动

   **解决方法：重采样**：对原边界以较大的网格重新采样，把与原边界点最接近的大网格点定为新的边界点。

   ![image-20230623164040692](.\images\image20230623164040692)

2. 对于同一个边界，选择不同起点会得到不同链码，目标旋转以后，得到的链码表示也不同

   **解决方法：起点归一化，旋转归一化**

   1. **起点归一化**：给定一个从任意点开始而产生的链码，把它看作一个由各方向数构成的自然数。将这些方向数依一个方向循环以使它们所构成的自然数的值最小。我们将这样转换后所对应的链码起点作为这个边界的归一化链码的起点 。

      ![image-20230623164315827](.\images\image20230623164315827)

   2. **旋转归一化**：利用链码的一阶差分来重新构造一个序列 。差分可用相邻两个方向数（按反方向）相减得到(记录方向变化)。

      ![image-20230623164430469](.\images\image20230623164430469)

### 6.2 基于区域的描述

#### 6.2.1 欧拉数

**1.定义**：对1个给定平面区域而言，区域内的孔数H和区域的连通成分C都是常用的拓扑性质，定义为**欧拉数E**

E= C - H

![image-20230623165159721](.\images\image20230623165159721)



#### 6.2.2 形状数

**1.定义**：形状数是基于链码的一种边界形状描述符是值最小的链码的差分码。【最小循环差分链码】

​			阶：为形状数序列的长度，即码的个数

![image-20230623164635844](.\images\image20230623164635844)

## 7.纹理分析

### 7.1 基本概念

**1.纹理**：按一定规则对元素（elements）或基元（primitives）进行排列所形成的重复模式。

**2.纹理的基本特征**：纹理是一种局部属性，具有重复性、规则性、周期性、方向性。 与尺度密切相关

### 7.2 结构描述方法

**基本思想**：复杂纹理是由简单纹理单元组成的。

**基本LBP特征（局部二值模式）**

在3*3的窗口内，以窗口中心像素为阈值，将相邻的8个像素的灰度值与其进行比较，若周围像素值大于中心像素值，则该像素点的位置被标记为1，否则为0。经比较可产生8位二进制数，即得到该窗口中心像素点的LBP值。

![image-20230623170110538](.\images\image20230623170110538)

### 7.3 常用的特征描述算子

#### 7.3.1 HARR特征

Haar特征是一种用于在图像中识别物体的轮廓或边缘的简单数字图像特征。由一系列简单的模板组成。

![image-20230623170347316](.\images\image20230623170347316)

![image-20230623170424700](.\images\image20230623170424700)

**一张图像含有HARR特征的个数为：
$$
XY(W+1-w\frac{X+1}{2})(H+1-h\frac{Y+1}{2})
$$
其中，W,H 图像宽高，w,h 特征宽度高度，X,Y表示矩形特征在水平和垂直方向的缩放系数
$$
X=\frac{W}{w} , Y =\frac{H}{h}
$$
![image-20230623170758496](.\images\image20230623170758496)

#### 7.3.2 HOG特征

**算法步骤**

1. 梯度计算  [借助模板[-1,0, 1] [-1,0,1]T
   $$
   G_x(x,y)=I(x+1,y)-I(x-1,y) \\
   G_y(x,y)=I(x,y+1)-I(x,y-1)
   $$
   其中，I(x,y)表示图像，Gx 表示x方向梯度，Gy表示y方向梯度。

2. 计算梯度方向直方图

   每一个像素对应有两个值：梯度/梯度方向，按照梯度方向划分为N个bin(常用N=9)，按Bin统计梯度直方图 ，按照block ，如8*8

3. 按照cell统计方向直方图
